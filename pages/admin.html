<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Admin Panel - User Management</h1>
<table border="1">
  <thead>
  <tr>
    <th>ID</th>
    <th>Email</th>
    <th>Role</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody id="user-list"></tbody>
</table>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const userList = document.getElementById("user-list");

    async function fetchUsers() {
      userList.innerHTML = ""; // Clear the list before fetching
      try {
        const response = await fetch("/admin/users");
        const users = await response.json();

        users.forEach(user => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${user._id}</td>
                    <td><input type="text" value="${user.email}" class="email-input" data-id="${user._id}"></td>
                    <td>
                        <select class="role-select" data-id="${user._id}">
                            <option value="user" ${user.role === "user" ? "selected" : ""}>User</option>
                            <option value="admin" ${user.role === "admin" ? "selected" : ""}>Admin</option>
                        </select>
                    </td>
                    <td>
                        <button class="save-btn" data-id="${user._id}">Save</button>
                        <button class="delete-btn" data-id="${user._id}">Delete</button>
                    </td>
                `;
          userList.appendChild(row);
        });

        document.querySelectorAll(".save-btn").forEach(button => {
          button.addEventListener("click", async (e) => {
            const userId = e.target.dataset.id;
            const emailInput = document.querySelector(`.email-input[data-id="${userId}"]`).value;
            const roleSelect = document.querySelector(`.role-select[data-id="${userId}"]`).value;

            const response = await fetch(`/admin/users/${userId}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email: emailInput, role: roleSelect })
            });

            const result = await response.json();
            alert(result.message);
            fetchUsers(); // Refresh list
          });
        });

        document.querySelectorAll(".delete-btn").forEach(button => {
          button.addEventListener("click", async (e) => {
            const userId = e.target.dataset.id;
            await fetch(`/admin/users/${userId}`, { method: "DELETE" });
            fetchUsers(); // Refresh list
          });
        });

      } catch (error) {
        console.error("Error loading users:", error);
      }
    }

    fetchUsers();
  });

</script>
</body>
</html>
